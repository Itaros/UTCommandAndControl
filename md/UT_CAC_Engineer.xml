<?xml version="1.0" encoding="UTF-8" ?>
<mdscript name="UT_CAC_Engineer" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://utnas/~unitrader/XRebirthxsds/md.xsd">

  <cues>

    <cue name="Main" instantiate="true" namespace="this">
      <conditions>
        <event_cue_signalled cue="this"/>
      </conditions>
      <actions>
        <set_value name="$actor" exact="event.param" />
        <set_comm_handler actor="$actor" customhandler="true" />
        <!-- From now on, only this instance tree is responsible for handling the entity conversation - only available for the Player, it will manage Personal costs, Dialogue Tree and Settings Config (interface to AIscripts are blackboard Vars and Signals)-->
        <start_script object="$actor" name="'ut.cac.base.manager'"/>
      </actions>
      <cues>
        
        <!--cue name="Payment" ref="md.UT_CAC_Lib.Payment">
          <param name="actor" value="$actor"/>
        </cue-->
        
        <cue name="NormalActor" onfail="cancel">
          <conditions>
            <check_value value="not $actor.iscontrolentity" />
          </conditions>
          <cues>
            <cue name="EngineerTimeout" ref="md.GenericMissions.PlatformActor">
              <param name="BaseCue" value="OnPlatformPopulation_Engineer" />
              <param name="Actor" value="$actor" />
              <param name="TimeoutMin" value="10min"/>
              <param name="TimeoutMax" value="20min"/>
            </cue>
          </cues>
        </cue>

        <cue name="ControlEntity" onfail="cancel">
          <conditions>
            <check_value value="$actor.iscontrolentity" />
            <check_value value="$actor.owner != faction.player"/>
          </conditions>
          <cues>
            <cue name="ControlEntityHandling" ref="md.GenericMissions.PersistentPlatformActor">
              <param name="BaseCue" value="OnPlatformPopulation_Engineer" />
              <param name="Actor" value="$actor" />
            </cue>
          </cues>
        </cue>
<!--
Dialogue Tree - rough concept (for all Entity Types)
1. Personal Managment
1.1 Show Skills
1.2 Show Finances (Actor account, Account Owner, Wages and Bonusses) -> also Options for Money Transfer, Account Sharing (and seperation)
1.3 Transfer Entity (not just from/to Skunk, but also tangential as long as its InZone)
1.4 Pester Level (how important should something be before pestering the Player - note that this also depends on the Player Situation) - PLANNED Feature
1.5 
1.6 Go back
2. Settings Managment - Entity Specific
2.1
2.2
2.3
2.4
2.5
2.6
3. Connect to other People   - Maybe also include an Option to connect to Subordinates with no consistent Position (move around as necesary)
      -> note that Station and CV are counted as the same in this Menu
3.1 Defense
3.2 Engineer
3.3 Architect
3.4 Superior
3.5 Captain/Pilot/Manager
3.6 Subordinates
4.
4.1
4.2
4.3
4.4
4.5
4.6
5.
5.1
5.2
5.3
5.4
5.5
5.6
6.
6.1
6.2
6.3
6.4
6.5
6.6
-->

        <cue name="Comm_MainMenu" instantiate="true">
          <conditions>
            <check_any>
              <event_conversation_started actor="$actor" convparam="'default'" />
              <event_conversation_returned_to_section actor="$actor" sectionprefix="Main" />
            </check_any>
          </conditions>
        </cue>
        
        <!-- Menu 1: Personal Settings (as lib since its shared with other NPC Types) -->
        <!-- Menu 3: Connect with other Actor-->
        <!-- (both Slots are in a shared Lib) -->
        <cue name="Comm_Common" instantiate="true" ref="md.UT_CAC_Lib.Comm_Common">
          <param name="actor" value="$actor"/>
        </cue>
        <!-- Menu 2: Object Settings specific to Engineer -->
        <!--cue name="Comm_Settings" instantiate="true"/-->
        
        <cue name="NPC_Destroyed">
          <conditions>
            <event_object_destroyed object="$actor"/>
          </conditions>
          <!--delay exact="1s" comment="delay as the PlatformActor library may also take care of this"/ currently not includes, so commented out -->
          <actions>
            <debug_text text="'NPC_Destroyed'"/>
            <cancel_cue cue="Main"/>
          </actions>
        </cue>
        
        <cue name="OnFired" instantiate="true">
          <conditions>
            <check_any>
              <event_conversation_finished actor="$actor" outcome="cEngineer_fire" />
            </check_any>
          </conditions>
          <delay exact="1s" />
          <actions>
            <play_cutscene key="'LeavePlayerShipWithDrone'">
              <param name="npcref" object="$actor" />
            </play_cutscene>
            <do_if value="not player.platform">
              <start_actor_transport actor="$actor" />
            </do_if>
          </actions>
        </cue>
        
      </cues>
    </cue>

  </cues>

</mdscript>
