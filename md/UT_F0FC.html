<?xml version="1.0" encoding="UTF-8"?>
<mdscript xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" name="UT_CAC_Lib" xsi:noNamespaceSchemaLocation="http://utnas/~unitrader/XRebirthxsds/md.xsd">
  <cues>
    <cue name="Cheat_Ship">
      <actions>
        <create_ship name="$ship" macro="macro.units_size_xl_builder_ship_macro" zone="player.zone">
          <owner exact="faction.player"/>
          <safepos x="0m" y="0m" z="-10km" radius="2km"/>
        </create_ship>
        <add_to_player_squad object="$ship"/>
        <find_dock_location name="$dock" container="$ship" multiple="false" />
        <create_platform_actor name="$pilot" dockingbay="$dock.component" type="entitytype.pilot"><owner exact="faction.player"/></create_platform_actor>
        <assign_pilot actor="$pilot" object="$ship"/>
        <create_platform_actor name="$defencemanager" dockingbay="$dock.component" type="entitytype.defencecontrol"><owner exact="faction.player"/></create_platform_actor>
        <assign_defence_manager actor="$defencemanager" object="$ship" />
        <create_platform_actor name="$engineer" dockingbay="$dock.component" type="entitytype.engineer"><owner exact="faction.player"/></create_platform_actor>
        <assign_engineer actor="$engineer" object="$ship"/>
        <create_platform_actor name="$architect" dockingbay="$dock.component" type="entitytype.architect"><owner exact="faction.player"/></create_platform_actor>
        <assign_architect actor="$architect" object="$ship"/>
        <create_platform_actor name="$manager" dockingbay="$dock.component" type="entitytype.manager"><owner exact="faction.player"/></create_platform_actor>
        <create_ship name="$ship" macro="macro.units_size_xl_builder_ship_macro" zone="player.zone">
          <owner exact="faction.player"/>
          <safepos x="0m" y="0m" z="-10km" radius="2km"/>
        </create_ship>
        <add_to_player_squad object="$ship"/>
        <find_dock_location name="$dock" container="$ship" multiple="false" />
        <create_platform_actor name="$pilot" dockingbay="$dock.component" type="entitytype.pilot"><owner exact="faction.player"/></create_platform_actor>
        <assign_pilot actor="$pilot" object="$ship"/>
        <create_platform_actor name="$defencemanager" dockingbay="$dock.component" type="entitytype.defencecontrol"><owner exact="faction.player"/></create_platform_actor>
        <assign_defence_manager actor="$defencemanager" object="$ship" />
        <create_platform_actor name="$engineer" dockingbay="$dock.component" type="entitytype.engineer"><owner exact="faction.player"/></create_platform_actor>
        <assign_engineer actor="$engineer" object="$ship"/>
        <create_platform_actor name="$architect" dockingbay="$dock.component" type="entitytype.architect"><owner exact="faction.player"/></create_platform_actor>
        <assign_architect actor="$architect" object="$ship"/>
        <create_platform_actor name="$manager" dockingbay="$dock.component" type="entitytype.manager"><owner exact="faction.player"/></create_platform_actor>
      </actions>
    </cue>
    <!-- ##################### End Testing Cheat #########################-->
    <library name="Payment">
      <params>
        <param name="actor"/>
      </params>
      <actions>
        <do_if value="not $actor.exists">
          <debug_text filter="general" text="'UT_CAC_Lib.Payment canceled because no valid Actor given'"/>
          <cancel_cue cue="this"/>
        </do_if>
        <do_if value="not $actor.$wage">
          <debug_text filter="general" text="'UT_CAC_Lib.Payment fell back to default Wage of 1Cr/h because no valid amount defined on Actor'"/>
          <set_value name="$actor.$wage" exact="1Cr"/>
        </do_if>
        <do_if value="not $actor.$riskbonus">
          <debug_text filter="general" text="'UT_CAC_Lib.Payment fell back to default Riskbonus of hourly Wage per 10min interval because no valid amount defined on Actor'"/>
          <set_value name="$actor.$riskbonus" exact="$actor.wage"/>
        </do_if>
      </actions>
      <cues>
        <cue name="Wage" comment="Wages are paid hourly">
          <actions>
            <!-- ToDo: Check if there is enough Money available and do apporiate steps if not (for example reduce skill or stop working for the Player altogether) -->
            <set_value name="$actor.money" exact="$actor.money - $actor.wage"/>
          </actions>
          <cues>
            <cue name="Wage_reset">
              <delay exact="1h"/>
              <actions>
                <reset_cue cue="Wage"/>
              </actions>
            </cue>
          </cues>
        </cue>
        <cue name="Riskbonus" comment="Risk Bonus is paid every 10 min while $actor.container is under Attack/in danger">
          <conditions>
            <event_object_attacked object="$actor.container"/>
          </conditions>
          <actions>
            <!-- ToDo: Check if there is enough Money available and do apporiate steps if not (for example reduce skill or stop working for the Player altogether) -->
            <!-- ToDo: Check if the Attack is serious by comparing Attack Forces with nearby own Forces - if it is no serious Attack reset this cue without demanding any bonus -->
            <set_value name="$actor.money" exact="$actor.money - $actor.riskbonus"/>
          </actions>
          <cues>
            <cue name="Riskbonus_reset">
              <delay exact="10min"/>
              <actions>
                <reset_cue cue="Riskbonus"/>
              </actions>
            </cue>
          </cues>
        </cue>
      </cues>
    </library>
    <!--
Dialogue Tree - rough concept (for all Entity Types)
1. Personal Managment
1.1 Show Skills
1.2 Show Finances (Actor account, Account Owner, Wages and Bonusses) -> also Options for Money Transfer, Account Sharing (and seperation)
1.3 Transfer Entity (not just from/to Skunk, but also tangential as long as its InZone)
1.4 Pester Level (how important should something be before pestering the Player - note that this also depends on the Player Situation) - PLANNED Feature
1.5 
1.6 Go back
- - - - - -
2. Settings Managment - Entity Specific
- - - - - -
3. Connect to other People   - Maybe also include an Option to connect to Subordinates with no consistent Position (move around as necesary)
      -> note that Station and CV are counted as the same in this Menu
3.1 Defense
3.2 Engineer
3.3 Architect
3.4 Superior
3.5 Captain/Pilot/Manager
3.6 Subordinates
- - - - - - -
4.
4.1
4.2
4.3
4.4
4.5
4.6
5.
5.1
5.2
5.3
5.4
5.5
5.6
6.
6.1
6.2
6.3
6.4
6.5
6.6
-->
    <library name="Comm_Common" instantiate="true">
      <params>
        <param name="actor"/>
      </params>
      <conditions>
        <check_any>
          <event_conversation_next_section sectionprefix="comm_personal_" actor="$actor"/>
          <event_conversation_returned_to_section sectionprefix="comm_personal_" actor="$actor"/>
          <event_conversation_next_section sectionprefix="comm_connect_" actor="$actor"/>
          <event_conversation_returned_to_section sectionprefix="comm_connect_" actor="$actor"/>
        </check_any>
      </conditions>
      <actions>
        <!--- ################################### -->
        <!--                       Personal Menu                          -->
        <!--- ################################### -->
        <do_if value="event.param == 'comm_personal_main'">
          <!-- ToDo: Spoken Text -->
          <add_player_choice_sub text="'Show me your Skills, please!'" position="1" section="comm_personal_skills" confidence="$actor.combinedskill / 20" />
          <add_player_choice_sub text="'Show me your Budget, please!'" position="2" section="comm_personal_money" confidence="3" comment="planned function for confidence: show if the Actor has not enough or too much money (optimum is 3)"/>
          <add_player_choice_sub text="'About your workplace..'" position="4" section="comm_personal_transfer" comment="planned, but not necesary yet" />
          <add_player_choice_sub text="'About your verbosity...'" position="4" section="comm_personal_pester" confidence="$actor.$pesterlevel / 20" />
          <add_player_choice_sub text="'\033RCleanup: remove Ship/Station (USE WITH CARE)\033X'" position="5" section="comm_personal_cleanup" selectable="$actor.container != player.entity.container" comment="temporary until everything works: completely remove Objects which have problems"/>
          <add_player_choice_sub text="'Lets do some pointless smalltalk'" position="5" section="comm_personal_smalltalk" selectable="false"/>
          <add_player_choice_return text="'(Back)'" position="6" />
          <add_player_choice_return text="'(Back)'" position="close" />
        </do_if>
        <do_elseif value="event.param == 'comm_personal_skills'">
          <open_conversation_menu menu="CharProfileMenu" param="[0, 0, $actor, 0, 1, $actor.container]" />
          <add_npc_line speaker="player.entity" line="[1130,1110].random" comment="Show me your profile/skills, please." />
          <add_npc_line speaker="$actor" line="4119" comment="Here you go." />
        </do_elseif>
        <do_elseif value="event.param == 'comm_personal_money'">
          <add_player_choice text="'Account Minimum: %sCr'.[$actor."
          <open_conversation_menu menu="MoneyTransferMenu" param="[0, 0, $actor]" />
        </do_elseif>
        <do_elseif value="event.param == 'comm_personal_budget'">
          <open_conversation_menu menu="SetMoneyLimitMenu" param="[0, 0, $actor, 'max']" />
        </do_elseif>
        <do_elseif value="event.param == 'comm_personal_transfer'">
          <!-- ToDo: Spoken Text -->
          <do_if value="player.entity.container != $actor.container">
            <add_player_choice text="'Work here'" position="1" section="comm_personal_transfer_selected" choiceparam="player.entity.room"/>
          </do_if>
          <do_elseif value="$actor.container != player.primarysip">
            <add_player_choice text="'Come on board of the %1'.[player.primaryship.name]" position="1" section="comm_personal_transfer_selected" choiceparam="player.primaryship"/>
          </do_elseif>
          <add_player_choice text="'Work somewhere else'" position="2" section="comm_personal_transfer_selectobject"/>
          <add_player_choice text="'You\'re fired'" position="3" section="comm_personal_transfer_fired"/>
          <add_player_choice text="'Suspend your Work/Start working'" position="4" section="comm_transfer_suspend"/>
          <add_player_choice_return text="'(Back)'" position="6" />
        </do_elseif>
        <do_elseif value="event.param == 'comm_personal_pester'">
          <!-- ToDo: Spoken Text -->
          <!-- ToDo: more indicative feedback for the Player about the current Pester Level (atm its simply the greyed out one) -->
          <do_if value="event.param2 != null">
            <set_value name="$actor.$pesterlevel" exact="(event.param2)i"/>
          </do_if>
          <add_player_choice text="'dont. say. anything. ever.'" position="1" section="comm_personal_pester" choiceparam="1" confidence="0" selectable="$actor.$pesterlevel != 1" />
          <add_player_choice text="'Ask me only in case of emergency'" position="2" section="comm_personal_pester" choiceparam="20" confidence="1" selectable="$actor.$pesterlevel != 20" />
          <add_player_choice text="'Ask me only for the important Stuff'" position="3" section="comm_personal_pester" choiceparam="40" confidence="2" selectable="$actor.$pesterlevel != 40" />
          <add_player_choice text="'Call me in case of doubt.'" position="4" section="comm_personal_pester" choiceparam="60" confidence="3" selectable="$actor.$pesterlevel != 60" />
          <add_player_choice text="'Call me in case of even trivial questions'" position="5" section="comm_personal_pester" choiceparam="80" confidence="4" selectable="$actor.$pesterlevel != 80" />
          <add_player_choice text="'Contact me for absolutely everything!'" position="6" section="comm_personal_pester" choiceparam="100" confidence="5" selectable="$actor.$pesterlevel != 100" />
          <add_player_choice_return text="'(Back)'" position="close" />
        </do_elseif>
        <do_elseif value="event.param == 'comm_personal_cleanup'">
          <destroy_object object="$actor.container" explosion="false"/>
        </do_elseif>
        <!--- ################################### -->
        <!--                        Connect Menu                          -->
        <!--- ################################### -->
        <do_elseif value="event.param == 'comm_connect_main'">
          <!-- Slot1: Defense Officer -->
          <do_if value="$actor.container.defencenpc.exists">
            <add_player_choice text="'Defence: %s'.[$actor.container.defencenpc.name]" position="1" section="comm_connect_selected" choiceparam="$actor.container.defencenpc" selectable="$actor.container.defencenpc != this"/>
          </do_if>
          <do_elseif value="$actor.container.buildingmodule.container.defencenpc.exists">
            <add_player_choice text="'Defence: %s'.[$actor.container.buildingmodule.container.defencenpc.name]" position="1" section="comm_connect_selected" choiceparam="$actor.container.buildingmodule.container.defencenpc" selectable="$actor.container.buildingmodule.container.defencenpc != this"/>
          </do_elseif>
          <do_elseif value="$actor.container.buildmodule.buildanchor.defencenpc.exists">
            <add_player_choice text="'Defence: %s'.[$actor.container.buildmodule.buildanchor.defencenpc.name]" position="1" section="comm_connect_selected" choiceparam="$actor.container.buildmodule.buildanchor.defencenpc" selectable="$actor.container.buildmodule.buildanchor.defencenpc != this"/>
          </do_elseif>
          <!-- Slot2: Engineer -->
          <do_if value="$actor.container.engineer.exists">
            <add_player_choice text="'Engineer: %s'.[$actor.container.engineer.name]" position="2" section="comm_connect_selected" choiceparam="$actor.container.engineer" selectable="$actor.container.engineer != this"/>
          </do_if>
          <do_elseif value="$actor.container.buildingmodule.container.engineer.exists">
            <add_player_choice text="'Engineer: %s'.[$actor.container.buildingmodule.container.engineer.name]" position="2" section="comm_connect_selected" choiceparam="$actor.container.buildingmodule.container.engineer" selectable="$actor.container.buildingmodule.container.engineer != this"/>
          </do_elseif>
          <do_elseif value="$actor.container.buildmodule.buildanchor.engineer.exists">
            <add_player_choice text="'Engineer: %s'.[$actor.container.buildmodule.buildanchor.engineer.name]" position="2" section="comm_connect_selected" choiceparam="$actor.container.buildmodule.buildanchor.engineer" selectable="$actor.container.buildmodule.buildanchor.engineer != this"/>
          </do_elseif>
          <!-- Slot3: Architect -->
          <do_if value="$actor.container.architect.exists">
            <add_player_choice text="'Architect: %s'.[$actor.container.architect.name]" position="3" section="comm_connect_selected" choiceparam="$actor.container.architect" selectable="$actor.container.architect != this"/>
          </do_if>
          <do_elseif value="$actor.container.buildingmodule.container.architect.exists">
            <add_player_choice text="'Architect: %s'.[$actor.container.buildingmodule.container.architect.name]" position="3" section="comm_connect_selected" choiceparam="$actor.container.buildingmodule.container.architect" selectable="$actor.container.buildingmodule.container.architect != this"/>
          </do_elseif>
          <do_elseif value="$actor.container.buildmodule.buildanchor.architect.exists">
            <add_player_choice text="'Architect: %s'.[$actor.container.buildmodule.buildanchor.architect.name]" position="3" section="comm_connect_selected" choiceparam="$actor.container.buildmodule.buildanchor.architect" selectable="$actor.container.buildmodule.buildanchor.architect != this"/>
          </do_elseif>
          <!-- Slot4: Superior -->
          <do_if value="$actor.container.commander.exists">
            <add_player_choice text="'Superior: %s'.[$actor.container.commander.name]" position="4" section="comm_connect_selected" choiceparam="$actor.container.commander" selectable="$actor.container.commander != this"/>
          </do_if>
          <do_elseif value="$actor.container.buildingmodule.container.architect.exists">
            <add_player_choice text="'Superior: %s'.[$actor.container.buildingmodule.container.commander.name]" position="4" section="comm_connect_selected" choiceparam="$actor.container.buildingmodule.container.commander"/>
          </do_elseif>
          <do_elseif value="$actor.container.buildmodule.buildanchor.architect.exists">
            <add_player_choice text="'Superior: %s'.[$actor.container.buildmodule.buildanchor.commander.name]" position="4" section="comm_connect_selected" choiceparam="$actor.container.buildmodule.buildanchor.commander"/>
          </do_elseif>
          <do_if value="$actor.container.pilot.exists">
            <add_player_choice text="'Captain: %s'.[$actor.container.pilot.name]" position="5" section="comm_connect_selected" choiceparam="$actor.container.pilot" selectable="$actor.container.pilot != this"/>
          </do_if>
          <!-- Slot5: Pilot/Captain/Manager -->
          <do_elseif value="$actor.container.tradenpc.exists">
            <add_player_choice text="'Manager: %s'.[$actor.container.tradenpc.name]" position="5" section="comm_connect_selected" choiceparam="$actor.container.tradenpc" selectable="$actor.container.tradenpc != this"/>
          </do_elseif>
          <do_elseif value="$actor.container.buildingmodule.container.pilot.exists">
            <add_player_choice text="'Captain: %s'.[$actor.container.buildingmodule.container.pilot.name]" position="5" section="comm_connect_selected" choiceparam="$actor.container.buildingmodule.container.pilot" selectable="$actor.container.buildingmodule.container.pilot != this"/>
          </do_elseif>
          <do_elseif value="$actor.container.buildingmodule.container.tradenpc.exists">
            <add_player_choice text="'Manager: %s'.[$actor.container.buildingmodule.container.tradenpc.name]" position="5" section="comm_connect_selected" choiceparam="$actor.container.buildingmodule.container.tradenpc" selectable="$actor.container.buildingmodule.container.tradenpc != this"/>
          </do_elseif>
          <do_elseif value="$actor.container.buildmodule.buildanchor.pilot.exists">
            <add_player_choice text="'Captain: %s'.[$actor.container.buildmodule.buildanchor.pilot.name]" position="5" section="comm_connect_selected" choiceparam="$actor.container.buildmodule.buildanchor.pilot" selectable="$actor.container.buildmodule.buildanchor.pilot != this"/>
          </do_elseif>
          <do_elseif value="$actor.container.buildmodule.buildanchor.tradenpc.exists">
            <add_player_choice text="'Manager: %s'.[$actor.container.buildmodule.buildanchor.tradenpc.name]" position="5" section="comm_connect_selected" choiceparam="$actor.container.buildmodule.buildanchor.tradenpc" selectable="$actor.container.buildmodule.buildanchor.tradenpc != this"/>
          </do_elseif>
          <!-- Slot6: Subordinates -->
          <add_player_choice_sub text="'Subordinates: %s'.[$actor.container.subordinates.{$actor.type}.count]" position="6" section="comm_connect_subordinates" selectable="$actor.container.subordinates.{$actor.type}.count" confidence="[$actor.container.subordinates.{$actor.type}.count - 1,5].min"/>
        </do_elseif>
        <do_elseif value="event.param == 'comm_connect_subordinates'">
          <do_all exact="[$actor.container.subordinates.{$actor.type}.count,6].min" counter="$i">
            <do_if value="$actor.container.subordinates.{$actor.type}.{$i}.isclass.station">
              <do_if value="$actor.container.subordinates.{$actor.type}.{$i}.tradenpc.exists">
                <add_player_choice text="'Manager: %s'.[$actor.container.subordinates.{$actor.type}.{$i}.tradenpc.name]" position="$i" section="comm_connect_selected" choiceparam="$actor.container.subordinates.{$actor.type}.{$i}.tradenpc"/>
              </do_if>
            </do_if>
            <do_elseif value="$actor.container.subordinates.{$actor.type}.{$i}.isclass.ship">
              <do_if value="$actor.container.subordinates.{$actor.type}.{$i}.pilot.exists">
                <add_player_choice text="'Captain: %s'.[$actor.container.subordinates.{$actor.type}.{$i}.pilot.name]" position="5" section="comm_connect_selected" choiceparam="$actor.container.subordinates.{$actor.type}.{$i}.pilot"/>
              </do_if>
            </do_elseif>
          </do_all>
          <add_player_choice_return text="'(Back)'" position="6" />
          <add_player_choice_return text="'(Back)'" position="close" />
        </do_elseif>
        <do_elseif value="event.param == 'comm_connect_selected'">
          <!-- Cancel this Conversation and start a new one with the desired Person -->
          <speak actor="$actor" line="[11,12,1005].random" chance="($actor.room != player.entity.room) * 100"/>
          <speak actor="$actor" line="[11,12,1006].random" chance="($actor.room == player.entity.room) * 100"/>
          <cancel_conversation actor="$actor"/>
          <start_conversation actor="event.param2" conversation="default"/>
        </do_elseif>
      </actions>
    </library>
  </cues>
</mdscript>
